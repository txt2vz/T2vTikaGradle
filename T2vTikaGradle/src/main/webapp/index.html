<!DOCTYPE html>
<html lang="en">  

<head>
<!-- Bootstrap CSS Toolkit styles -->

<link rel="stylesheet"
	href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
<!--  	href="http://blueimp.github.com/cdn/css/bootstrap.min.css"> -->
<!-- Generic page styles -->
<link rel="stylesheet" href="css/style.css">
<!-- Bootstrap styles for responsive website layout, supporting different screen sizes -->
<link
	href="http://getbootstrap.com/2.3.2/assets/css/bootstrap-responsive.css"
	rel="stylesheet">
<!-- Bootstrap CSS fixes for IE6 -->
<!--[if lt IE 7]><link rel="stylesheet" href="http://blueimp.github.com/cdn/css/bootstrap-ie6.min.css"><![endif]-->
<!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
<link rel="stylesheet" href="css/jquery.fileupload-ui.css">

<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>t2vd3</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
<script src="js/vendor/jquery.ui.widget.js"></script>
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="js/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="js/jquery.fileupload.js"></script>
<script src="http://malsup.github.com/jquery.form.js"></script>
<script type="text/javascript"
	src="http://mbostock.github.com/d3/d3.js?2.9.2"></script>

<style type="text/css">
.link {
	stroke: #666; //
	stroke-width: 2px;
}
</style>
</head>
<body>
	<div class="container">
		<em style="font-size: 48px"><b> <span
				style="color: blueviolet">t</span><span style="color: cyan">xt</span><span
				style="color: magenta">2</span><span style="color: cyan">vz</span></b></em>:
		<span style="font-family: arial; font-size: 17px;">Visualize
			your Documents.</span>

		<nav class="navbar navbar-inverse" role="navigation">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">

				<a class="navbar-brand" href="index.html">Viz</a> <a
					class="navbar-brand" href="info.html">Information</a>
			</div>
		</nav>


		<div id='content' class='row-fluid'>
			<div class='span10 main active'>

				<script>
					function drawLinks(jsonlinks) {
						//alert("in drawlinks " + jsonlinks);
						d3.select("svg").remove();
						var linksobj;
						
						if (jsonlinks==null || typeof jsonlinks =='object'){
							linksobj = jsonlinks; 
						}
						else linksobj = JSON.parse(jsonlinks);

					//	var linksobj = jsonlinks; // JSON.parse(jsonlinks);
						var links = linksobj.links;

						var w = 960, h = 500;
						var nodes = {};

						var svg = d3.select(".main").append("svg").attr("width",
								w).attr("height", h);

						// Compute the distinct nodes from the links.
						links.forEach(function(link) {
							var sc = link.source;
							var tg = link.target;
							link.source = nodes[sc] || (nodes[sc] = {
								name : sc,
								rank : link.rank,
								numberLinks:0
							});
							link.target = nodes[tg] || (nodes[tg] = {
								name : tg,
								rank : link.rank,
								numberLinks:0
							});

							//count number of links for each node
							nodes[sc].numberLinks++;
							nodes[tg].numberLinks++;
							});

						var force = d3.layout.force().gravity(.05)
										.charge(-200).size([ w, h ]);

						
						force.nodes(d3.values(nodes)).links(links)
								.linkDistance(function(d) {
									if (d.rank<7) return 80;
									else if (d.rank <11) return 100;
									else return 170;
								}).start();

						var link = svg.selectAll(".link").data(links).enter()
								.append("line").attr("stroke-width",
										function(d) {
											if (d.rank <4)
												return 1;
											else
												return 0.1;
										}).attr("class", "link");

						var node = svg.selectAll(".node")
								.data(d3.values(nodes)).enter().append("g")
								.attr("class", "node").call(force.drag);
						
						node.append("rect").attr("width", function(d){
							return 120;
						}).attr("height" , function (d){
							return 20;
						}).attr("ry" , 8)
						.attr("rx" , 8)
						.attr("y", -15)
						.attr("x", -5)
						
	
						.attr("opacity", function (d) {
							if (d.rank < 1)
								return 1;
							else
								if (d.rank<3 ||d.numberLinks>2)
								return 0.7
								else return 0.4;
						})
						.attr("fill", function(d) {
					
					
				    	if (d.rank < 2)
							return "magenta";//"#66FFFF";							
						else
							if (d.numberLinks >2) 
								return     "blueviolet";//"blue"; 
				    	               // "blueviolet";
							else
							return  "cyan";//"yellowgreen"
					});

						node.append("text").attr("font-size", function(d) {
							if (d.rank < 1)		
								return 20;
							else
								if (d.rank < 4 ||d.numberLinks>2)
								return 14;
								else return 10;
						})
						//.attr("x", 1)
					   //  .attr("y", 15)
						.text(function(d) {
							return d.name
						});

						force.on("tick", function() {
							link.attr("x1", function(d) {
								return d.source.x;
							}).attr("y1", function(d) {
								return d.source.y;
							}).attr("x2", function(d) {
								return d.target.x;
							}).attr("y2", function(d) {
								return d.target.y;
							});

							node.attr("transform", function(d) {
								return "translate(" + d.x + "," + d.y + ")";
							});
						});
					}
				</script>
				<script>
	//	var jl = "{"links":[{"source":"laurie", "target":"hirsch, "rank":0}]}";
	var jl ={};
	jl.links =[{'source':'txt2vz', 'target' : 'by', 'rank':7},
	           {'source':'laurie', 'target' : 'by', 'rank':8},
	           {'source':'txt2vz', 'target' : 'document', 'rank':0},	         
	           {'source':'analysis', 'target' : 'visualization', 'rank':2},
	           {'source':'summary', 'target' : 'visualization', 'rank':3},
	           {'source':'concept', 'target' : 'visualization', 'rank':4},
	           {'source':'document', 'target' : 'mind', 'rank':7},
	           {'source':'mind', 'target' : 'map', 'rank':7},
	           {'source':'document', 'target' : 'visualization', 'rank':1},
	           {'source':'laurie', 'target' : 'hirsch', 'rank':2}	
	
	];
		drawLinks(jl);
		</script>
			</div>

			<div class='span2 sidebar'>
				<h3>Select Source</h3>
				Select a file to visualize (e.g. pdf, docx, xml, ppt, txt, html
				etc.) You can also drag and drop your file here.
				<!-- The fileinput-button span is used to style the file input field as button -->
				<span class="btn btn-success fileinput-button"> <i
					class="icon-plus icon-white"></i> <span>Select File</span> <!-- The file input field used as target for the file upload widget -->
					<input id="fileupload" type="file" name="files[]" multiple>
				</span> <br> <br />
				<!-- The global progress bar -->
				<div id="progress"
					class="progress progress-success progress-striped">
					<div class="bar"></div>
				</div>
				<!-- The container for the uploaded files -->
				<div id="files"></div>
				<br>
				<p>Type in a Twitter query or Hashtag:</p>

				<input type="text" name="twitQ" id="twitQ" size=40
					value="word cloud"> <input type="button"
					value="viz Twitter" onclick="lookupTwit(twitQ.value)"> <br />
				<br /> Type in a URL <input type="text" id="url2"
					value="https://en.wikipedia.org/wiki/Tag_cloud" size=40>

				<button onclick="lookupURL(url2.value)">viz URL</button>

				<br /> <br />
				<p>Paste in text</p>

				<textarea id="txta1" COLS="30" ROWS="5"
					placeholder="Type or paste text here"> </textarea>
				<input type="button" value="viz text" onclick="pasted(txta1.value)">

				<br></br>

				<script>
					/*jslint unparam: true *//*global window, $ */
					$(function() {
						//'use strict';
						$('#fileupload').fileupload(
								{
									url : "uploadservice",//url,
									dataType : 'text',
									done : function(e, data) {
										//	alert('data is ' + data.result.files);

										//   $.each(data.result.files, function (index, file) {
										// alert ('f ' + data.result.files.name);
										// $('<p/>').text(file.name).appendTo('#files');
										//    });
										//alert ("tyring");
										drawLinks(data.result);
									},
									progressall : function(e, data) {
										var progress = parseInt(data.loaded
												/ data.total * 100, 10);
										$('#progress .bar').css('width',
												progress + '%');
									}
								});
					});
				</script>

				<script>
					function pasted(s) {
						s= s.replace(/%/g, '');
						
						$.ajax({
							type : "POST",
							url : "pastedText.groovy",
							cache : false,
							data : "s=" + s,
							success : function(data, textStatus, jqXHR) {
								drawLinks(data);
							},
						
						});
					}
				</script>

				<script type="text/javascript">
			
					function lookupURL(url) {
						$.ajax({
							type : "POST",
							url : "url.groovy",
							cache : false,
							data : "u=" + url,
							success : function(data, textStatus, jqXHR) {
								drawLinks(data);
							},
							error : function(jqXHR, textStatus, errorThrown) {
								alert("error " + textStatus);
							}
						});
					}
				</script>

				<script type="text/javascript">
					function lookupTwit(twq) {

						$.ajax({
							type : "POST",
							//url : "twitservice",
							url : "twitter.groovy",
							cache : false,
							data : "q=" + twq,
							success : function(data, textStatus, jqXHR) {
								//alert("in twit jq " + data);
								drawLinks(data);
							},
							error : function(jqXHR, textStatus, errorThrown) {
								alert("error " + textStatus);
							}
						});
					}
				</script>
				
			</div>
		</div>

	</div>
</body>
</html>