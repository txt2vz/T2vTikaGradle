<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js">
<link
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
	rel="stylesheet">


<style type="text/css">
.node {
	cursor: pointer;
}

.overlay {
	background-color: #FFF;
}

.node circle {
	fill: #fff;
	stroke: steelblue;
	stroke-width: 1.5px;
}

.node text {
	font-size: 10px;
	font-family: sans-serif;
}

.link {
	fill: none;
	stroke: #ccc;
	stroke-width: 1.5px;
}

.well {
	background-color: #e6fff2;
}
</style>

<body>
	<div class="container  col-md-12">
		<h1>txt2vz Tree</h1>
		<p>Select fields, choose a valid text file and upload/draw:</p>
		<div class="well col-md-12">
			<div class="row">


				<div class="col-md-3">
					Show Tree:
					<form id="expanded">
						<input type="radio" id="full" name="type" value="full">
						Fully Expanded <br /> <input type="radio" id="oneLevel"
							name="type" value="oneLevel" checked="true"> One Level
					</form>
				</div>

				<div class="col-md-3">

					<p>Paste in text</p>

					<textarea id="txta1" COLS="30" ROWS="5"
						placeholder="Type or paste text here"> </textarea>
					<input type="button" value="viz text" onclick="pasted(txta1.value)">

					<br></br>
				</div>

				<div class="col-md-3">
					<input type="file" id="files" />
				</div>

				<div class="col-md-3">
					<button id="upload">Upload->Draw Tree</button>
				</div>
			</div>
		</div>
		<div class="row col-md-12">
			<div id="tree-container"></div>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="js/drawDendrogram.js"></script>
	
	<script>
		function pasted(s) {
			s = s.replace(/%/g, '');

			$.ajax({
				type : "POST",
				url : "textIn.groovy",
				cache : false,
				data : "s=" + s,
				success : function(data, textStatus, jqXHR) {
					//drawLinks(data);
					console.log("data back from draw " + data);
					drawDendrogram(data);
				},

			});
		}
	</script>
	<script>
		function fileUpload(e) {

			var f = e.target.result;
			console.log(" inf file upload f is " + f);

			$.ajax({
				type : "POST",
				url : "textIn.groovy",
				cache : false,
				data : "s=" + f,
				success : function(data, textStatus, jqXHR) {
					//drawLinks(data);
					console.log("data back from draw " + data);
					drawDendrogram(data);
				},

			});
		}
	</script>


	<script>
		var fileInput = $('#files');
		var uploadButton = $('#upload');

		uploadButton.on('click', function() {
			if (!window.FileReader) {
				alert('Your browser is not supported')
			}
			var input = fileInput.get(0);

			// Create a reader object
			var reader = new FileReader();
			if (input.files.length) {
				var textFile = input.files[0];
				reader.readAsText(textFile);

				console.log("text file " + textFile);
				$(reader).on('load', fileUpload);
			} else {
				alert('Please select a valid text file before continuing')
			}
		});
	</script>


</body>
</html>